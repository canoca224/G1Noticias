(()=>{"use strict";var e=function(e,r){return void 0===e&&(e={}),void 0===r&&(r=[]),Object.keys(e).filter((t=>r.includes(e[t].name))).map((r=>e[r]))},r="page_perf",t="video_perf",n=e=>{var r;return e-((null==globalThis||null==(r=globalThis.glbDebug)?void 0:r.firstTick)||0)},a=function(e,r,t,n,a){void 0===n&&(n=null),void 0===a&&(a=null),globalThis.HorizonClient&&globalThis.HorizonClient.then((o=>{o.send({id:"common-event",version:"0.1",contentType:"common",properties:{eventCategory:e,eventAction:r,eventLabel:n,eventValue:t,eventProperty:a}})})).catch((e=>{console.error(e)}))};function o(){return o=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(this,arguments)}var i=[{label:"player_api_feed",url:"https://p.glbimg.com/api/stable/api.min.js",regex:"p.glbimg.com/api/stable/api.min.js"},{label:"player",regex:"/player.min.js",trackWhenLabel:"player_api"},{label:"player_settings",regex:"/web/settings/stable/settings.min.js",trackWhenLabel:"player_api"}],s={assetsInfo:[],observerResources:void 0},l=e=>s.assetsInfo.find((r=>r.label===e)),c=function(e){return void 0===e&&(e=[]),e.regex||e.url},u=()=>s.assetsInfo.filter((e=>!(e.state.duration>=0||e.isFired||e.noTrack))),v=()=>{s.observerResources&&s.observerResources.disconnect(),s.observerResources=void 0},f=()=>{var e=u();if(!e.length)return v(),null;var t=function(e,r){void 0===r&&(r=[]);var t=e.filter((e=>!!c(e))).map((e=>c(e))),n=new RegExp("("+t.join("|")+")","gmi");return function(e,r){return void 0===e&&(e=[]),void 0===r&&(r=()=>{}),e.filter((e=>r(e))).map((e=>e.toJSON()))}(r,(e=>e.name.match(n)))}(e,globalThis.performance.getEntriesByType("resource"));return t&&t.length&&t.forEach((e=>{var t=s.assetsInfo.find((r=>e.name.includes(c(r))));t&&(t.state.duration=Number.parseInt(e.duration,10),t.state.start=Number.parseInt(e.startTime,10),(e=>{e&&!e.isFired&&(a(r,"asset_download",e.state.duration,e.label,"start="+e.state.start),e.isFired=!0)})(t))})),t},p=()=>{var e;!s.observerResources&&u().length&&(e=f,s.observerResources=new globalThis.PerformanceObserver((r=>e(r.getEntries()))),s.observerResources.observe({type:"resource",buffered:undefined}),s.observerResources)},d=()=>{s.assetsInfo.filter((e=>e.trackWhenLabel)).forEach((e=>{e.state=e.state||{};var r=l(e.trackWhenLabel);e.noTrack=!r||r.noTrack}))};function b(e,r,t,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void t(e)}s.done?r(l):Promise.resolve(l).then(n,a)}var g="data-loaded",h="data-has-error",m=e=>new Promise(((r,t)=>{var n,a,o=(r,n)=>{var a,o;e&&e.label&&(a=e.label,!(o=l(a))||o.isFired||o.noTrack||(o.noTrack=!0,d()),s.assetsInfo),n&&n.setAttribute(h,""),t(r)};if(e){var i=e.getObj||(()=>globalThis[e.name]);if(i())r(i());else{var c=document.querySelector('script[src="'+e.url+'"]');if(c||(c=(e=>{var r=document.createElement("script");return r.setAttribute("src",e),r.setAttribute("async",!0),document.head.appendChild(r),r})(e.url))&&e.label&&(n=e.label,(a=l(n))&&!a.isFired&&a.noTrack&&(a.noTrack=!1,d(),p()),s.assetsInfo),c){var u=c.hasAttribute(h),v=c.hasAttribute(g);u||v?u?o(new Error("load error")):r(i()):(c.addEventListener("load",(()=>{c.setAttribute(g,""),r(i())}),{once:!0}),c.addEventListener("error",(e=>{o(e,c)}),{once:!0}))}else o(new Error("no script element"))}}else o(new Error("no config"))})),y=function(){var r,t=(r=function*(r,t,n){void 0===n&&(n=!1);var a=t?e(r,t):function(e){return void 0===e&&(e={}),Object.keys(e).filter((r=>!!e[r].pluginName)).map((r=>e[r]))}(r),o=[];try{yield Promise.all([...a.map((e=>m(e).catch((r=>{o.push(e.name),console.error("[playerAssets::getAsset] "+e.url,r)}))))])}catch(e){console.error(e)}var i=a.filter((e=>!o.includes(e.name))),s=function(e,r){return void 0===e&&(e=[]),void 0===r&&(r=!1),e.filter((e=>r?!!e.isContainer:!e.isContainer)).map((e=>((e,r)=>{var t=r=>{var t;try{var n=globalThis[e.name];e.isDefault&&n&&(n=globalThis[e.name].default);var a=e.needsClappr?globalThis.Clappr:void 0;t=n?n(r||a):void 0}catch(e){console.error(e)}return t};return r?t():t})(e,n))).filter((e=>!!e))};return{core:[...s(i)],container:[...s(i,!0)]}},function(){var e=this,t=arguments;return new Promise((function(n,a){var o=r.apply(e,t);function i(e){b(o,n,a,i,s,"next",e)}function s(e){b(o,n,a,i,s,"throw",e)}i(void 0)}))});return function(e,r,n){return t.apply(this,arguments)}}();function T(){return T=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},T.apply(this,arguments)}function P(e,r,t,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void t(e)}s.done?r(l):Promise.resolve(l).then(n,a)}function k(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var o=e.apply(r,t);function i(e){P(o,n,a,i,s,"next",e)}function s(e){P(o,n,a,i,s,"throw",e)}i(void 0)}))}}var w={profiles:[]},A=function(){var e=k((function*(e){var l,c;void 0===e&&(e={}),w.profiles=[],w.config=JSON.parse(JSON.stringify(e)),globalThis.promiseResolvePlayerAssets&&globalThis.promiseResolvePlayerAssets(),(e=>{if(e&&e.tsTick){var{tsTick:t,perfVersion:o}=e;a(r,"after_content",n(t),null,"perf_version="+o+"&vw="+globalThis.innerWidth+"&vh="+globalThis.innerHeight)}})(globalThis.playerAssetsInfo),((e,r)=>{(function(e){void 0===e&&(e=i),s.assetsInfo=[...e],v()})(r),globalThis.PerformanceObserver&&(Object.values(e).forEach((e=>{s.assetsInfo.push(o({},e))})),s.assetsInfo.filter((e=>!e.trackWhenLabel)).forEach((e=>{e.state=e.state||{},e.url&&(document.querySelector('script[src="'+e.url+'"]')?e.hasScript=!0:e.noTrack=!0)})),d(),p()),s.assetsInfo})(w.config),(c=m(null==(l=w.config)?void 0:l.WM))&&c.then((()=>{a(t,"player_api_available",n(Date.now())),setTimeout((()=>{globalThis.WM&&globalThis.WM.playerAvailable&&globalThis.WM.playerAvailable.then((()=>{a(t,"player_available",n(Date.now()))})).catch((e=>{console.error(e)}))}),10)})).catch((e=>{console.error(e)}))}));return function(r){return e.apply(this,arguments)}}(),O=e=>w.profiles.find((r=>r.profileId===e));w.init=A,w.getPlugins=function(){var e=k((function*(e,r){return void 0===r&&(r=!1),y(w.config,e,r)}));return function(r,t){return e.apply(this,arguments)}}(),w.getPluginsByProfile=function(e,r){void 0===r&&(r=!1);var t=O(e),n=t?t.pluginNames:void 0;return y(w.config,n,r)},w.getPluginConfigsByProfile=r=>{var t=O(r),n=t?t.pluginNames:void 0;return e(w.config,n)},w.getAsset=m,w.registerProfile=function(r,t){var n;if(void 0===t&&(t={}),r&&!O(r)){var a=(r=>{var t,{pluginNames:n=[]}=r,a=e(w.config,n);return a&&(t={pluginNames:a.map((e=>e.name))}),t})(t);a&&(n=T({profileId:r},a),w.profiles.push(n))}return n},globalThis.playerAssetsManager=w,w.init(globalThis.playerAssetsConfig)})();